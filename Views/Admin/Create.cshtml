@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Admin Dashboard";
    ViewData["IsAdminPage"] = true;
}
<div class="min-h-[80vh] flex items-center justify-center p-6 pt-28 bg-gradient-to-br from-slate-50 to-blue-50/50">
    
    <!-- 1. THE WRAPPER (This is the anchor for the floating button) -->
    <div class="relative w-full max-w-2xl">

        <!-- 2. THE FLOATING BACK BUTTON (Desktop) -->
        <!-- 'absolute -left-20' pushes it 5rem (80px) to the left of the card -->
        <!-- 'hidden lg:flex' means it hides on tablets/phones and only shows on big screens -->
        <a href="/Admin/AdminIndex" class="absolute -left-24 top-6 hidden lg:flex flex-col items-center gap-2 text-slate-400 hover:text-slate-600 transition-all group text-decoration-none z-10" title="Back to Dashboard">
            <div class="p-4 bg-white rounded-full shadow-sm border border-slate-200 group-hover:border-blue-300 group-hover:shadow-md group-hover:-translate-x-1 transition-all">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
            </div>
            <span class="text-xs font-bold opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap delay-75">Go Back</span>
        </a>
        
        <!-- 3. MOBILE BACK BUTTON (Visible only on small screens) -->
        <a href="/Admin/AdminIndex" class="lg:hidden flex items-center gap-2 text-slate-500 mb-4 font-bold text-sm hover:text-slate-800 transition-colors text-decoration-none">
             <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
             Back to Dashboard
        </a>

        <!-- 4. MAIN CARD (Your Form) -->
        <div class="bg-white border border-slate-200 rounded-3xl shadow-xl overflow-hidden">
            
            <!-- Header -->
            <div class="bg-gradient-to-r from-blue-600 to-blue-500 px-8 py-6 text-white flex items-center justify-between">
                <div>
                    <h2 class="text-2xl font-bold tracking-tight">Create New Project</h2>
                    <p class="text-blue-100 text-sm mt-1">Showcase your latest work</p>
                </div>
                <div class="bg-white/20 p-3 rounded-xl backdrop-blur-sm">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                </div>
            </div>

            <!-- Form Body -->
            <div class="p-8">
                <form method="post" enctype="multipart/form-data" class="space-y-6">
                    @Html.AntiForgeryToken()
                    <div>
                        <label class="block text-sm font-bold text-slate-700 mb-2">Project Name</label>
                        <input type="text" name="Title" placeholder="e.g. AI Portfolio Website" required
                               class="w-full px-4 py-3 bg-slate-50/50 border border-slate-200 rounded-xl focus:bg-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all font-medium text-slate-800 placeholder:text-slate-400">
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-slate-700 mb-2">Description</label>
                        <textarea name="Description" rows="5" placeholder="Tell the story of this project..." required
                                  class="w-full px-4 py-3 bg-slate-50/50 border border-slate-200 rounded-xl focus:bg-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all font-medium text-slate-800 resize-none placeholder:text-slate-400"></textarea>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-bold text-slate-700 mb-2">Project URL <span class="text-slate-400 font-normal ml-1">(Optional)</span></label>
                            <input type="url" name="ProjectUrl" placeholder="https://myproject.com" 
                                   class="w-full px-4 py-3 bg-slate-50/50 border border-slate-200 rounded-xl focus:bg-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all font-medium text-slate-600 placeholder:text-slate-400">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-slate-700 mb-2">GitHub URL</label>
                            <input type="url" name="GitHubUrl" placeholder="https://github.com/username/repo" required
                                   class="w-full px-4 py-3 bg-slate-50/50 border border-slate-200 rounded-xl focus:bg-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all font-medium text-slate-600 placeholder:text-slate-400">
                        </div>
                    </div>

                    <!-- MEDIA UPLOAD SECTION -->
                    <div class="space-y-4">
                        <label class="block text-sm font-bold text-slate-700">
                            Project Media
                            <span class="text-slate-400 font-normal ml-1">(Max 3 Images, 1 Video)</span>
                        </label>

                        <!-- 1. The Drop Area -->
                        <label class="flex flex-col items-center justify-center w-full h-40 border-2 border-slate-300 border-dashed rounded-xl cursor-pointer hover:bg-blue-50/50 hover:border-blue-400 transition-all group bg-slate-50/30 relative">
                            <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                <svg class="w-10 h-10 mb-3 text-slate-400 group-hover:text-blue-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                <p class="text-sm text-slate-500 group-hover:text-blue-600 font-medium">Click to add files</p>
                            </div>
                            <!-- Note: We removed 'onchange' from here, we handle it in JS -->
                            <input type="file" id="mediaInput" class="hidden" multiple accept="image/*,video/*" />
                        </label>

                        <!-- 2. The Gallery (Where thumbnails appear) -->
                        <!-- This grid sits neatly BELOW the box -->
                        <div id="gallery-grid" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <!-- Thumbnails will be injected here by JS -->
                        </div>
                    </div>

                    <!-- 3. The Lightbox (Hidden by default) -->
                    <!-- Full screen overlay with black background -->
                    <div id="lightbox" class="fixed inset-0 z-[100] bg-black/90 hidden flex items-center justify-center backdrop-blur-sm">

                        <!-- Close Button -->
                        <button type="button" onclick="closeLightbox()" class="absolute top-6 right-6 text-white/70 hover:text-white z-50">
                            <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                        </button>

                        <!-- Navigation Arrows -->
                        <button type="button" onclick="changeSlide(-1)" class="absolute left-4 p-4 text-white/50 hover:text-white hover:bg-white/10 rounded-full transition-all">
                            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                        </button>
                        <button type="button" onclick="changeSlide(1)" class="absolute right-4 p-4 text-white/50 hover:text-white hover:bg-white/10 rounded-full transition-all">
                            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                        </button>

                        <!-- The Content -->
                        <div class="max-w-5xl max-h-[85vh] w-full p-4 flex items-center justify-center">
                            <img id="lightbox-img" class="max-w-full max-h-[80vh] object-contain hidden rounded-lg shadow-2xl" />
                            <video id="lightbox-video" controls class="max-w-full max-h-[80vh] hidden rounded-lg shadow-2xl"></video>
                        </div>

                        <!-- Counter -->
                        <div class="absolute bottom-6 left-1/2 -translate-x-1/2 text-white/80 font-mono text-sm bg-black/50 px-3 py-1 rounded-full">
                            <span id="current-slide">1</span> / <span id="total-slides">1</span>
                        </div>
                    </div>

                    <div class="flex items-center justify-end gap-4 pt-6 border-t border-slate-100 mt-8">
                        <a href="/Admin/AdminIndex" class="px-6 py-2.5 rounded-xl font-bold text-slate-500 hover:bg-slate-100 hover:text-slate-700 transition-colors text-decoration-none">Cancel</a>
                        <button type="submit" class="px-8 py-2.5 rounded-xl font-bold text-white bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 shadow-lg shadow-blue-200/50 hover:shadow-blue-300/50 transform hover:-translate-y-0.5 transition-all">
                            Publish Project
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<script>
    // 1. The State
    let allFiles = []; // Keeps track of all files in memory
    let currentSlideIndex = 0;

    const input = document.getElementById('mediaInput');
    const gallery = document.getElementById('gallery-grid');
    const lightbox = document.getElementById('lightbox');
    const lbImg = document.getElementById('lightbox-img');
    const lbVideo = document.getElementById('lightbox-video');

    // 2. Listen for new files
    // 2. Listen for new files with STRICT LIMITS
    input.addEventListener('change', function(e) {
        const newFiles = Array.from(e.target.files);

        // Count what we already have in our backpack
        let currentImageCount = allFiles.filter(f => f.type.startsWith('image/')).length;
        let currentVideoCount = allFiles.filter(f => f.type.startsWith('video/')).length;

        newFiles.forEach(file => {
            const isVideo = file.type.startsWith('video/');
            const isImage = file.type.startsWith('image/');
            const fileSizeMB = file.size / (1024 * 1024); // Convert bytes to MB

            // CHECK 1: VIDEO LIMITS
            if (isVideo) {
                if (currentVideoCount >= 1) {
                    alert(`Skipped "${file.name}": Only 1 video allowed.`);
                    return; // Skip this file
                }
                if (fileSizeMB > 100) {
                    alert(`Skipped "${file.name}": Video too large (Max 100MB).`);
                    return;
                }
                // If passed, add it
                currentVideoCount++;
                allFiles.push(file);
            }

            // CHECK 2: IMAGE LIMITS
            else if (isImage) {
                if (currentImageCount >= 3) {
                    alert(`Skipped "${file.name}": Only 3 images allowed.`);
                    return;
                }
                if (fileSizeMB > 5) {
                    alert(`Skipped "${file.name}": Image too large (Max 5MB).`);
                    return;
                }
                // If passed, add it
                currentImageCount++;
                allFiles.push(file);
            }
        });

        updateInputAndGallery();
        // Reset the input so you can select the same file again if you deleted it
        input.value = '';
    });

    // 3. Sync Logic: Updates the UI and the Hidden Input
    function updateInputAndGallery() {
        // A. Update the HTML Input (The DataTransfer Trick)
        const dt = new DataTransfer();
        allFiles.forEach(file => dt.items.add(file));
        input.files = dt.files; // This is how we "save" edits to the form

        // B. Render the Gallery
        gallery.innerHTML = ''; // Clear current display

        allFiles.forEach((file, index) => {
            const url = URL.createObjectURL(file);
            const isVideo = file.type.startsWith('video');

            // Create Thumbnail Card
            const card = document.createElement('div');
            card.className = "relative group h-32 rounded-xl overflow-hidden border border-slate-200 bg-slate-100 cursor-pointer shadow-sm hover:shadow-md transition-all";

            // Thumbnail Content
            if (isVideo) {
                 card.innerHTML = `
                    <video src="${url}" class="w-full h-full object-cover opacity-90"></video>
                    <div class="absolute inset-0 flex items-center justify-center"><div class="bg-white/30 rounded-full p-2"><svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg></div></div>
                 `;
            } else {
                card.innerHTML = `<img src="${url}" class="w-full h-full object-cover" />`;
            }

            // Click to Open Lightbox
            card.onclick = (e) => {
                if(!e.target.closest('.delete-btn')) openLightbox(index);
            };

            // Delete Button (The Red X)
            const btn = document.createElement('button');
            btn.className = "delete-btn absolute top-2 right-2 p-1 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-600 shadow-sm z-10";
            btn.innerHTML = `<svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>`;
            btn.type = "button"; // Prevent form submit
            btn.onclick = (e) => {
                e.stopPropagation(); // Don't open lightbox
                removeFile(index);
            };

            card.appendChild(btn);
            gallery.appendChild(card);
        });
    }

    // 4. Remove a file
    function removeFile(index) {
        allFiles.splice(index, 1); // Remove from array
        updateInputAndGallery(); // Re-sync everything
    }

    // 5. Lightbox Functions
    function openLightbox(index) {
        currentSlideIndex = index;
        updateLightboxContent();
        lightbox.classList.remove('hidden');
        document.body.style.overflow = 'hidden'; // Lock scroll
    }

    function closeLightbox() {
        lightbox.classList.add('hidden');
        lbVideo.pause(); // Stop video if playing
        document.body.style.overflow = 'auto'; // Unlock scroll
    }

    function changeSlide(direction) {
        currentSlideIndex += direction;
        // Loop logic
        if (currentSlideIndex >= allFiles.length) currentSlideIndex = 0;
        if (currentSlideIndex < 0) currentSlideIndex = allFiles.length - 1;

        updateLightboxContent();
    }

    function updateLightboxContent() {
        const file = allFiles[currentSlideIndex];
        const url = URL.createObjectURL(file);
        const isVideo = file.type.startsWith('video');

        document.getElementById('current-slide').innerText = currentSlideIndex + 1;
        document.getElementById('total-slides').innerText = allFiles.length;

        if (isVideo) {
            lbImg.classList.add('hidden');
            lbVideo.classList.remove('hidden');
            lbVideo.src = url;
        } else {
            lbVideo.classList.add('hidden');
            lbVideo.pause();
            lbImg.classList.remove('hidden');
            lbImg.src = url;
        }
    }
</script>